{"version":3,"file":"index-2964dba5.js","sources":["../../../resources/js/utils/axios-req.js","../../../resources/js/hooks/use-table.js","../../../resources/js/views/error-log/index.vue"],"sourcesContent":["import axios from \"axios\";\r\nimport { ElLoading, ElMessage, ElMessageBox } from \"element-plus\";\r\nimport { useBasicStore } from \"@/store/auth\";\r\nimport { langTitle } from \"@/hooks/use-common\";\r\n\r\n//使用axios.create()创建一个axios请求实例\r\nconst service = axios.create();\r\nlet loadingInstance = null; //loading实例\r\n//请求前拦截\r\nservice.interceptors.request.use(\r\n    (req) => {\r\n        const { token, axiosPromiseArr } = useBasicStore();\r\n        //axiosPromiseArr收集请求地址,用于取消请求\r\n        req.cancelToken = new axios.CancelToken((cancel) => {\r\n            axiosPromiseArr.push({\r\n                url: req.url,\r\n                cancel,\r\n            });\r\n        });\r\n        //设置token到header\r\n        req.headers[\"AUTHORIZE_TOKEN\"] = token;\r\n        //如果req.method给get 请求参数设置为 ?name=xxx\r\n        if (\"get\".includes(req.method?.toLowerCase())) req.params = req.data;\r\n\r\n        //req loading\r\n        // @ts-ignore\r\n        if (req.reqLoading ?? true) {\r\n            loadingInstance = ElLoading.service({\r\n                lock: true,\r\n                fullscreen: true,\r\n                // spinner: 'CircleCheck',\r\n                text: \"loading...\",\r\n                background: \"rgba(0, 0, 0, 0.3)\",\r\n            });\r\n        }\r\n\r\n        return req;\r\n    },\r\n    (err) => {\r\n        //发送请求失败\r\n        Promise.reject(err);\r\n    }\r\n);\r\n//请求后拦截\r\nservice.interceptors.response.use(\r\n    (res) => {\r\n        if (loadingInstance) {\r\n            loadingInstance && loadingInstance.close();\r\n        }\r\n\r\n        //download file\r\n        if (\r\n            [\"application/zip\", \"zip\", \"blob\", \"arraybuffer\"].includes(\r\n                res.headers[\"content-type\"]\r\n            )\r\n        ) {\r\n            return res;\r\n        }\r\n        const { code, msg } = res.data;\r\n        const successCode = \"0,200,20000\";\r\n        const noAuthCode = \"401,403\";\r\n        if (successCode.includes(code)) {\r\n            return res.data;\r\n        } else {\r\n            if (noAuthCode.includes(code)) {\r\n                ElMessageBox.confirm(langTitle(\"relogin_title\"), {\r\n                    confirmButtonText: langTitle(\"relogin\"),\r\n                    closeOnClickModal: false,\r\n                    showCancelButton: false,\r\n                    showClose: false,\r\n                    type: \"warning\",\r\n                }).then(() => {\r\n                    useBasicStore().resetStateAndToLogin();\r\n                });\r\n            }\r\n            // @ts-ignore\r\n            if (!res.config?.isNotTipErrorMsg) {\r\n                ElMessage.error({\r\n                    message: msg,\r\n                    duration: 2 * 1000,\r\n                });\r\n            }\r\n            return Promise.reject(msg);\r\n        }\r\n    },\r\n    //响应报错\r\n    (err) => {\r\n        if (loadingInstance) {\r\n            loadingInstance && loadingInstance.close();\r\n        }\r\n        console.log(err);\r\n        ElMessage.error({\r\n            message: err,\r\n            duration: 2 * 1000,\r\n        });\r\n        return Promise.reject(err);\r\n    }\r\n);\r\n//导出service实例给页面调用 , config->页面的配置\r\nexport default function axiosReq(config) {\r\n    return service({\r\n        baseURL: \"http://vapi.youlai.tech\",\r\n        // baseURL: import.meta.env.VITE_APP_BASE_URL,\r\n        timeout: 8000,\r\n        ...config,\r\n    });\r\n}\r\n","import { ref } from \"vue\";\r\nimport momentMini from \"moment-mini\";\r\nimport { elConfirm, elMessage } from \"./use-element\";\r\nimport axiosReq from \"@/utils/axios-req\";\r\nexport const useTable = (searchForm, selectPageReq) => {\r\n    /*define ref*/\r\n    const tableListData = ref([]);\r\n    const totalPage = ref(0);\r\n    const pageNum = ref(1);\r\n    const pageSize = ref(20);\r\n\r\n    //列表请求\r\n    const tableListReq = (config) => {\r\n        const data = Object.assign(\r\n            {\r\n                pageNum: pageNum.value,\r\n                pageSize: pageSize.value,\r\n            },\r\n            JSON.parse(JSON.stringify(searchForm))\r\n        );\r\n        Object.keys(data).forEach((fItem) => {\r\n            if ([\"\", null, undefined, Number.NaN].includes(data[fItem]))\r\n                delete data[fItem];\r\n            if (config.method === \"get\") {\r\n                if (Array.isArray(data[fItem])) delete data[fItem];\r\n                if (data[fItem] instanceof Object) delete data[fItem];\r\n            }\r\n        });\r\n        const reqConfig = {\r\n            data,\r\n            ...config,\r\n        };\r\n        return axiosReq(reqConfig);\r\n    };\r\n\r\n    /**\r\n     * 日期范围选择处理\r\n     * @param timeArr choose the time\r\n     * @author 熊猫哥\r\n     * @date 2022/9/25 14:02\r\n     */\r\n    const dateRangePacking = (timeArr) => {\r\n        if (timeArr && timeArr.length === 2) {\r\n            searchForm.startTime = timeArr[0];\r\n            //取今天23点\r\n            if (searchForm.endTime) {\r\n                searchForm.endTime = momentMini(timeArr[1])\r\n                    .endOf(\"day\")\r\n                    .format(\"YYYY-MM-DD HH:mm:ss\");\r\n            }\r\n        } else {\r\n            searchForm.startTime = \"\";\r\n            searchForm.endTime = \"\";\r\n        }\r\n    };\r\n    //当前页\r\n    const handleCurrentChange = (val) => {\r\n        pageNum.value = val;\r\n        selectPageReq();\r\n    };\r\n    const handleSizeChange = (val) => {\r\n        pageSize.value = val;\r\n        selectPageReq();\r\n    };\r\n    const resetPageReq = () => {\r\n        pageNum.value = 1;\r\n        selectPageReq();\r\n    };\r\n\r\n    /*多选*/\r\n    const multipleSelection = ref([]);\r\n    const handleSelectionChange = (val) => {\r\n        multipleSelection.value = val;\r\n    };\r\n    /*批量删除*/\r\n    const multiDelBtnDill = (reqConfig) => {\r\n        let rowDeleteIdArr = [];\r\n        let deleteNameTitle = \"\";\r\n        rowDeleteIdArr = multipleSelection.value.map((mItem) => {\r\n            deleteNameTitle = `${deleteNameTitle + mItem.id},`;\r\n            return mItem.id;\r\n        });\r\n        if (rowDeleteIdArr.length === 0) {\r\n            elMessage(\"selection is required\", \"warning\");\r\n            return;\r\n        }\r\n        const stringLength = deleteNameTitle.length - 1;\r\n        elConfirm(\r\n            \"delete\",\r\n            `Are you confirm to delete 【${deleteNameTitle.slice(\r\n                0,\r\n                stringLength\r\n            )}】 ?`\r\n        ).then(() => {\r\n            const data = rowDeleteIdArr;\r\n            axiosReq({\r\n                data,\r\n                method: \"DELETE\",\r\n                bfLoading: true,\r\n                ...reqConfig,\r\n            }).then(() => {\r\n                elMessage(\"Delete Success\");\r\n                resetPageReq();\r\n            });\r\n        });\r\n    };\r\n    //单个删除\r\n    const tableDelDill = (row, reqConfig) => {\r\n        elConfirm(\"Confirm\", `Are you sure to delete【${row.id}】?`).then(\r\n            () => {\r\n                axiosReq(reqConfig).then(() => {\r\n                    resetPageReq();\r\n                    elMessage(`【${row.id}】delete success`);\r\n                });\r\n            }\r\n        );\r\n    };\r\n\r\n    return {\r\n        pageNum,\r\n        pageSize,\r\n        totalPage,\r\n        tableListData,\r\n        tableListReq,\r\n        dateRangePacking,\r\n        multipleSelection,\r\n        handleSelectionChange,\r\n        handleCurrentChange,\r\n        handleSizeChange,\r\n        resetPageReq,\r\n        multiDelBtnDill,\r\n        tableDelDill,\r\n    };\r\n};\r\n","<template>\r\n  <div class=\"mt-10px query-page-style\">\r\n    <!--条件搜索-->\r\n    <el-form ref=\"refSearchForm\" :inline=\"true\" :model=\"searchForm\">\r\n      <el-form-item prop=\"log\">\r\n        <el-input v-model=\"searchForm.log\" class=\"w-150px\" placeholder=\"log\" />\r\n      </el-form-item>\r\n      <el-form-item prop=\"pageUrl\">\r\n        <el-input v-model=\"searchForm.pageUrl\" class=\"w-200px\" placeholder=\"pageUrl\" />\r\n      </el-form-item>\r\n      <el-form-item prop=\"startEndArr\">\r\n        <el-date-picker\r\n          v-model=\"searchForm.startEndArr\"\r\n          type=\"daterange\"\r\n          format=\"YYYY-MM-DD\"\r\n          value-format=\"YYYY-MM-DD HH:mm:ss\"\r\n          class=\"w-250px\"\r\n          range-separator=\"-\"\r\n          start-placeholder=\"startDate\"\r\n          end-placeholder=\"endDate\"\r\n          @change=\"dateRangePacking\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"resetPageReq\">search</el-button>\r\n        <el-button type=\"primary\" @click=\"resetForm\">reset</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n    <div class=\"rowES mb-10px\">\r\n      <el-button type=\"primary\" @click=\"multiDelBtnClick\">\r\n        <!--        <el-icon style=\"vertical-align: middle\">-->\r\n        <!--          <Delete />-->\r\n        <!--        </el-icon>-->\r\n        <span style=\"vertical-align: middle\">multiDel</span>\r\n      </el-button>\r\n    </div>\r\n    <!--表格和分页-->\r\n    <el-table\r\n      id=\"resetElementDialog\"\r\n      ref=\"refuserTable\"\r\n      :height=\"`calc(100vh - 260px)`\"\r\n      border\r\n      :data=\"tableListData\"\r\n      @selection-change=\"handleSelectionChange\"\r\n    >\r\n      <el-table-column type=\"selection\" align=\"center\" width=\"50\" />\r\n      <el-table-column align=\"center\" prop=\"errorLog\" label=\"Log\" min-width=\"250\">\r\n        <template #default=\"{ row }\">\r\n          <div class=\"btn-click-style\" @click=\"copyValueToClipboard(row.errorLog)\">{{ row.errorLog }}}</div>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column show-overflow-tooltip align=\"center\" prop=\"pageUrl\" label=\"Page URL\" min-width=\"120\" />\r\n      <el-table-column show-overflow-tooltip align=\"center\" prop=\"version\" label=\"Version\" min-width=\"80\" />\r\n      <el-table-column show-overflow-tooltip align=\"center\" prop=\"browserType\" label=\"Browser\" min-width=\"120\" />\r\n      <el-table-column show-overflow-tooltip align=\"center\" prop=\"createTime\" label=\"Created At\" min-width=\"120\" />\r\n      <!--点击操作-->\r\n      <el-table-column fixed=\"right\" align=\"center\" label=\"Action\" width=\"72\">\r\n        <template #default=\"{ row }\">\r\n          <div class=\"table-operation-btn\">\r\n            <span @click=\"tableDelClick(row)\">Delete</span>\r\n          </div>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <!--分页-->\r\n    <div v-if=\"totalPage >= 10\" class=\"rowCC mt-20px\">\r\n      <el-pagination\r\n        :current-page=\"pageNum\"\r\n        :page-sizes=\"[10, 20, 50, 100]\"\r\n        :page-size=\"pageSize\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\"\r\n        :total=\"totalPage\"\r\n        @size-change=\"handleSizeChange\"\r\n        @current-change=\"handleCurrentChange\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup lang=\"ts\" name=\"error-collection\">\r\n//import { Delete, FolderAdd } from '@element-plus/icons-vue'\r\nimport { reactive, ref, onMounted } from 'vue';\r\nimport { useTable } from '@/hooks/use-table'\r\nimport { copyValueToClipboard } from '@/hooks/use-common'\r\nconst searchForm = reactive({\r\n  log: '',\r\n  pageUrl: '',\r\n  startEndArr: ''\r\n})\r\nconst selectPageReq = () => {\r\n  const reqConfig = {\r\n    url: '/integration-front/errorCollection/selectPage',\r\n    method: 'get'\r\n  }\r\n  tableListReq(reqConfig).then(({ data }) => {\r\n    tableListData.value = data.records\r\n    totalPage.value = data.total\r\n  })\r\n}\r\n//重置\r\nconst refSearchForm = ref()\r\nconst resetForm = () => {\r\n  refSearchForm.value.resetFields()\r\n  dateRangePacking(['', ''])\r\n  resetPageReq()\r\n}\r\n\r\n//批量删除\r\nconst multiDelBtnClick = () => {\r\n  const reqConfig = {\r\n    url: '/integration-front/errorCollection/deleteBatchIds',\r\n    method: 'delete',\r\n    bfLoading: true\r\n  }\r\n  multiDelBtnDill(reqConfig)\r\n}\r\n\r\n//单个删除\r\nconst tableDelClick = (row) => {\r\n  const reqConfig = {\r\n    url: '/integration-front/errorCollection/deleteById',\r\n    params: { id: row.id },\r\n    method: 'delete'\r\n  }\r\n  tableDelDill(row, reqConfig)\r\n}\r\n\r\n//添加和修改详情\r\nonMounted(() => {\r\n  selectPageReq()\r\n})\r\n\r\n//引入table-query相关的hooks 方法\r\nlet {\r\n  pageNum,\r\n  pageSize,\r\n  totalPage,\r\n  tableListData,\r\n  tableListReq,\r\n  dateRangePacking,\r\n  handleSelectionChange,\r\n  handleCurrentChange,\r\n  handleSizeChange,\r\n  resetPageReq,\r\n  multiDelBtnDill,\r\n  tableDelDill\r\n} = useTable(searchForm, selectPageReq)\r\n</script>\r\n\r\n<style scoped lang=\"scss\"></style>\r\n"],"names":["service","axios","loadingInstance","req","token","axiosPromiseArr","useBasicStore","cancel","_a","_b","ElLoading","err","res","code","msg","successCode","noAuthCode","ElMessageBox","langTitle","ElMessage","axiosReq","config","useTable","searchForm","selectPageReq","tableListData","ref","totalPage","pageNum","pageSize","tableListReq","data","fItem","reqConfig","dateRangePacking","timeArr","momentMini","handleCurrentChange","val","handleSizeChange","resetPageReq","multipleSelection","rowDeleteIdArr","deleteNameTitle","mItem","elMessage","stringLength","elConfirm","row","reactive","refSearchForm","resetForm","multiDelBtnClick","multiDelBtnDill","tableDelClick","tableDelDill","onMounted","handleSelectionChange"],"mappings":"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"}